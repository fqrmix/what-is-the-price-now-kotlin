# Парсинговый бот на Selenium

Этот проект представляет собой бот на Kotlin, предназначенный для парсинга цен с различных онлайн-ресурсов, включая маркетплейсы, такие как Ozon и Яндекс.Маркет. 
Бот использует Selenium с настройками stealth-режима, чтобы имитировать поведение человека и предотвращать детекцию ботов. 
Также он управляет данными через слой персистентности, поддерживает несколько парсеров и уведомляет пользователей об изменении цены по подписке.

## Основные функции

- **Скрейпинг с использованием stealth:** Использование Selenium и stealth-плагинов для избежания блокировок.
- **Модульная система парсеров:** Поддержка различных парсеров для различных сайтов.
- **Управление пользователями и подписками:** Отслеживание подписок пользователей и уведомление о статусе товаров.
- **Интеграция с базой данных:** Хранение информации о товарах, пользователях и подписках.
- **Автоматическое выполнение команд:** Регулярное выполнение задач, таких как парсинг данных и отправка уведомлений.

## Используемый стек технологий

- **Kotlin** — основной язык разработки для реализации логики приложения и взаимодействия с базой данных.
- **Coroutines** — библиотека для асинхронного программирования в Kotlin, используемая для обработки параллельных задач и повышения отзывчивости приложения. Позволяет легко выполнять операции ввода-вывода без блокировки основного потока, что особенно полезно для длительных операций парсинга.
- **Selenium** — фреймворк для автоматизации браузера, используется для парсинга веб-страниц и взаимодействия с веб-элементами.
  - **ChromeDriver** — драйвер для управления браузером Google Chrome.
  - **Selenium Stealth** — библиотека для модификации свойств Selenium и уменьшения шансов быть обнаруженным как бот.
- **Exposed** — ORM для Kotlin, используется для взаимодействия с базой данных.
- **PostgreSQL** — база данных для хранения информации о товарах, пользователях и подписках.
- **Gson** — библиотека для работы с JSON, используется для сериализации и десериализации данных.
- **Logback** — библиотека для логирования, используется для отслеживания выполнения задач и ошибок.
- **Gradle** — инструмент для управления зависимостями и сборки проекта.

---

## Структура проекта

```plaintext
src
├── main
│   ├── kotlin
│   │   ├── Main.kt                    # Точка входа в приложение
│   │   ├── bot
│   │   │   └── ChatBot.kt             # Управление взаимодействием с пользователями
│   │   ├── command
│   │   │   ├── CheckArticlePriceCommand.kt # Команда для проверки обновлений цен
│   │   │   └── ParseArticleCommand.kt      # Команда для парсинга новых товаров
│   │   ├── common
│   │   │   ├── MessageTexts.kt             # Общие сообщения бота
│   │   │   ├── RunnableTask.kt             # Базовый класс для задач
│   │   │   └── Scheduler.kt                # Планировщик и управление задачами
│   │   ├── parser
│   │   │   ├── Parser.kt                   # Базовый интерфейс для парсеров
│   │   │   ├── ParserConstants.kt          # Константы для логики парсинга
│   │   │   ├── ParserFactory.kt            # Фабрика для создания парсеров
│   │   │   ├── ozon
│   │   │   │   └── OzonParserImpl.kt       # Реализация парсера для Ozon
│   │   │   ├── selenium
│   │   │   │   ├── SeleniumManager.kt      # Менеджер для инициализации WebDriver
│   │   │   │   └── stealth
│   │   │   │       ├── SeleniumStealth4j.kt   # Конфигурация стелс-режима для Selenium
│   │   │   │       └── SeleniumStealthWrapper.kt # Обертка для стелс-настроек
│   │   │   ├── vinylbox
│   │   │   │   └── VinylBoxParserImpl.kt   # Реализация парсера для VinylBox
│   │   │   └── yandex
│   │   │       └── YandexMarketParserImpl.kt # Реализация парсера для Яндекс.Маркета
│   │   ├── service
│   │   │   ├── ArticleService.kt          # Сервис для управления товарами
│   │   │   ├── SubscriptionService.kt     # Сервис для управления подписками
│   │   │   ├── TaskService.kt             # Сервис для задач
│   │   │   └── UserService.kt             # Сервис для управления пользователями
│   │   └── storage
│   │       ├── Database.kt                # Настройки и конфигурация базы данных
│   │       ├── dao
│   │       │   ├── ArticleDao.kt          # DAO для работы с товарами
│   │       │   ├── SubscriptionDao.kt     # DAO для работы с подписками
│   │       │   └── UserDao.kt             # DAO для работы с пользователями
│   │       ├── models
│   │       │   ├── Article.kt             # Модель товара
│   │       │   ├── Subscription.kt        # Модель подписки
│   │       │   ├── Tariff.kt              # Модель тарифа
│   │       │   └── User.kt                # Модель пользователя
│   │       ├── repository
│   │       │   ├── SubscriptionRepository.kt # Репозиторий подписок
│   │       │   └── UserRepository.kt      # Репозиторий пользователей
│   │       └── tables
│   │           ├── Articles.kt            # Таблица для хранения товаров
│   │           ├── Subscriptions.kt       # Таблица для хранения подписок
│   │           └── Users.kt               # Таблица для хранения пользователей
│   └── resources
│       └── js
│           ├── chrome.app.js              # Скрипты для настройки стелса
│           ├── chrome.csi.js
│           ├── chrome.loadTimes.js
│           ├── chrome.runtime.js
│           ├── hairline.fix.js
│           ├── iframe.contentWindow.js
│           ├── media.codecs.js
│           ├── navigator.languages.js
│           ├── navigator.permissions.js
│           ├── navigator.plugins.js
│           ├── navigator.vendor.js
│           ├── navigator.webdriver.js
│           ├── utils.js
│           ├── webgl.vendor.js
│           └── window.outerdimensions.js
└── test
    ├── kotlin                            # Тесты на Kotlin
    └── resources                         # Ресурсы для тестов
